LIST P=16F84A
STATUS	EQU	0X03
PORTA	EQU	0X05
PORTB	EQU	0X06
DCounter1 EQU 0X0C
DCounter2 EQU 0X0D
DCounter3 EQU 0X0E
DATA01 EQU 0X0F
DATA02 EQU 0X0B

ORG 0

BSF	STATUS,5
CLRF	PORTB	;Inicializamos las Salidas
BCF	STATUS,5

CLRF 	PORTA
CLRF 	PORTB

INICIO


MOVLW 	.3
CALL 	VECES_AVA
CALL	IZQ
CALL 	AVA
CALL	DESINF ; 1 DESINFECCION
CALL	DER
CALL	DESINF ; 2 DES

CALL	IZQ
CALL	IZQ
MOVLW	.2
CALL	VECES_AVA
CALL	DESINF ; 3
CALL	IZQ
CALL	DESINF ; 4

CALL	DER
CALL	DER
CALL 	AVA
CALL	DESINF; 5
CALL	DER
CALL	DESINF ; 6

CALL	IZQ
CALL	IZQ
CALL	AVA
CALL	DER
CALL	AVA
CALL	DER
MOVLW	.4
CALL	VECES_AVA
CALL	DESINF2 ;7  DE 90 A -90

CALL	IZQ
CALL	IZQ
CALL	AVA
CALL	DER
CALL	AVA
CALL	DESINF ; 8

CALL	IZQ
MOVLW	.2
CALL	VECES_AVA
CALL	DESINF ; 9

CALL	DER
CALL	AVA
CALL	IZQ
CALL	AVA
CALL	DESINF ; 10

CALL	DER
CALL	DER
MOVLW	.4
CALL	VECES_AVA
CALL	DESINF ; 11

CALL	IZQ
CALL	AVA
CALL	IZQ
CALL	AVA
CALL	DESINF ;12
CALL	IZQ
CALL	DESINF ; 13

CALL	DER
CALL	DER
CALL	AVA
CALL	IZQ
CALL	AVA
CALL	DESINF ; 14
CALL	IZQ
CALL	DESINF ; 15
CALL	IZQ
CALL	DESINF ;16
CALL	IZQ
CALL	DESINF ;17

CALL	AVA
CALL	DER
MOVLW	.2
CALL	VECES_AVA ; META FINAL

	


GOTO INICIO

;COMANDOS

PULSO_45:
   CALL ON
   MOVLW .134        
   CALL TIME_MICRO
   CALL OFF
   MOVLW .1866        
   CALL TIME_MICRO
   RETURN

PULSO_MENOS_45:
   CALL ON
   MOVLW .95      
   CALL TIME_MICRO
   CALL OFF
   MOVLW .1905       
   CALL TIME_MICRO
   RETURN
   
PULSO_90:
   CALL ON
   MOVLW .160         ; Pulso activo de 3 ms
   CALL TIME_MICRO
   CALL OFF
   MOVLW .1866         ; Pulso inactivo de 37 ms
   CALL TIME_MICRO    
   RETURN

PULSO_NO90:
   CALL ON
   MOVLW .20        ; Pulso activo de 1 ms
   CALL TIME_MICRO
   CALL OFF
   MOVLW .1905         ; Pulso inactivo de 39 ms
   CALL TIME_MICRO
   RETURN
   
   
   
ON
   MOVLW	B'00000001'
   MOVWF	PORTB    ; Enciende el pin del servo en RB2
   RETURN

OFF
   MOVLW	B'00000000'
   MOVWF	PORTB     ; Apaga el pin del servo en RB2
   RETURN
   
AVA
   ;SEGUIR	8 SEGUNDOS	AVANZAMOS
   MOVLW	B'00000110'
   MOVWF	PORTB
   MOVLW .8
   CALL TIME
   RETURN

IZQ
   ;GIRO 6 SEGUNDOS	IZQUIERDA
   MOVLW	B'00000100'
   MOVWF	PORTB
   MOVLW .6
   CALL TIME
   RETURN

DER
   ;GIRO 6 SEGUNDOS	DERECHA
   MOVLW	B'00000010'
   MOVWF	PORTB
   MOVLW .6
   CALL TIME
   RETURN

DESINF
   ;2 SEGUNDOS		DESINFECTAR      45 a -45
   
   CALL PULSO_45
   CALL DELAY1
   CALL PULSO_MENOS_45
   CALL DELAY1
   RETURN
   
DESINF2
   ;2 SEGUNDOS		DESINFECTAR      90 a -90
   
   CALL PULSO_90
   CALL DELAY1
   CALL PULSO_NO90
   CALL DELAY1
   RETURN
   
VECES_AVA
   MOVWF DATA02
   NO_ES_CERO_V
   CALL AVA
   DECFSZ DATA02,1
   GOTO NO_ES_CERO_V
   RETURN
   
   
TIME
   MOVWF DATA01
   NO_ES_CERO
   CALL DELAY1
   DECFSZ DATA01,1
   GOTO NO_ES_CERO
   RETURN

TIME_MICRO
   MOVWF DATA01
   NO_ES_CERO_MICRO
   CALL DELAY
   DECFSZ DATA01,1
   GOTO NO_ES_CERO_MICRO
   RETURN

;DELAY DE 1 SEGUNDO
DELAY1
MOVLW 0Xac 
MOVWF DCounter1 
MOVLW 0X13 
MOVWF DCounter2 
MOVLW 0X06 
MOVWF DCounter3 
LOOP1 
DECFSZ DCounter1, 1 
GOTO LOOP1 
DECFSZ DCounter2, 1 
GOTO LOOP1 
DECFSZ DCounter3, 1 
GOTO LOOP1 
NOP 
RETURN 

;DELAY DE 0.01 MILISEGUNDO
DELAY
MOVLW 0X01
MOVWF DCounter1 
LOOP
DECFSZ DCounter1, 1 
GOTO LOOP
NOP 
NOP 
RETURN 


END